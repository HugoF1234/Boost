{% extends "base.html" %}
{% block content %}
<style>
    /* Styles spÃ©cifiques Ã  la page actualitÃ©s - Les styles principaux sont dans style.css */
    .news-section {
        background: var(--white); /* blanc pur pour cartes */
        border-radius: 12px; /* coins arrondis */
        padding: 2.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
        box-shadow: var(--shadow-soft); /* ombres lÃ©gÃ¨res */
        position: relative;
        overflow: hidden;
        animation: gentleFadeIn 0.8s ease-out;
    }
    .news-section::before {
        content: '';
        position: absolute;
        top: 0; right: 0;
        width: 120px; height: 120px;
        background: radial-gradient(circle, rgba(255, 107, 107, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(30%, -30%);
        animation: gentle-pulse 8s ease-in-out infinite alternate;
    }
    @keyframes gentleFadeIn {
        from { opacity: 0; transform: translateY(20px);}
        to { opacity: 1; transform: translateY(0);}
    }
    @keyframes gentle-pulse {
        0% { opacity: 0.6; transform: translate(30%, -30%) scale(1);}
        100% { opacity: 1; transform: translate(30%, -30%) scale(1.2);}
    }
    .news-header {
        font-size: 1.75rem;
        font-weight: 700; /* typographie bold pour titres */
        color: var(--black); /* noir profond pour titres */
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.7em;
    }
    @keyframes gradient-shift {
        0%,100% {background-position: 0% 50%;}
        50% {background-position: 100% 50%;}
    }
    .news-subtitle {
        color: var(--gray-dark); /* gris foncÃ© pour texte secondaire */
        font-size: 1.1rem;
        font-weight: 400;
        margin-bottom: 2rem;
    }
    .news-form-row {
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: 1.5rem;
        align-items: end;
        margin-bottom: 2rem;
    }
    .news-form-group label {
        font-weight: 500;
        color: var(--noble-charcoal);
        margin-bottom: 0.5em;
    }
    .news-form-control {
        width: 100%;
        padding: 1rem 1.5rem;
        border: 1.5px solid var(--noble-accent-light);
        border-radius: 12px;
        font-size: 1rem;
        background: rgba(248,250,252,0.7);
        transition: all 0.3s;
    }
    .news-form-control:focus {
        outline: none;
        border-color: var(--primary-coral);
        background: #fff;
    }
    .btn-noble {
        padding: 0.9rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        border: none;
        cursor: pointer;
        background: var(--primary-purple);
        color: white;
        box-shadow: 0 4px 15px rgba(107, 71, 255, 0.25);
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 0.7em;
    }
    .btn-noble:hover {
        filter: brightness(1.05);
        transform: translateY(-2px);
    }
    .news-sector {
        color: var(--primary-coral);
        font-weight: 500;
        margin-bottom: 1em;
    }
    .news-error {
        background: #fee2e2;
        color: #b91c1c;
        border-radius: 12px;
        padding: 1em;
        margin-bottom: 1em;
        border: 1px solid #fca5a5;
    }
    .news-selected-article {
        background: #ffffff;
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        z-index: 1;
    }
    .news-selected-article h3 {
        color: var(--primary-coral);
        font-weight: 700;
        margin-bottom: 0.5em;
    }
    .news-articles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }
    .news-article-card {
        background: #fff;
        border-radius: 16px;
        border: 1px solid var(--noble-accent-light);
        box-shadow: var(--shadow-whisper);
        padding: 0;
        display: flex;
        flex-direction: column;
        min-height: 420px;
        transition: all 0.3s;
        overflow: hidden;
        position: relative;
    }
    .news-article-card:hover {
        transform: translateY(-2px) scale(1.01);
        box-shadow: var(--shadow-gentle);
        border-color: var(--primary-coral);
    }
    .news-article-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: var(--noble-mist);
        display: block;
    }
    .news-article-image-placeholder {
        width: 100%;
        height: 180px;
        background: var(--noble-mist);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--noble-accent-light);
        font-size: 2.5em;
    }
    .news-article-content {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        padding: 2rem 2rem 1rem 2rem;
        min-height: 180px;
    }
    .news-article-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--noble-charcoal);
        margin-bottom: 0.7rem;
    }
    .news-article-description {
        color: var(--noble-charcoal-light);
        font-size: 0.98em;
        margin-bottom: 1.2em;
        line-height: 1.6;
    }
    .news-article-meta {
        font-size: 0.9em;
        color: var(--noble-accent-light);
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 1em;
        margin-top: auto;
        padding-bottom: 0.7em;
    }
    .news-article-actions {
        display: flex;
        gap: 0.7em;
        width: 100%;
        justify-content: space-between;
        align-items: stretch;
        padding: 0 2rem 2rem 2rem;
        box-sizing: border-box;
    }
    .btn-glass {
        flex: 1 1 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5em;
        font-size: 1.05em;
        font-weight: 600;
        border-radius: 1.5em;
        border: none;
        padding: 0.85em 0;
        margin: 0;
        box-shadow: 0 2px 8px 0 rgba(139,154,124,0.06);
        transition: all 0.15s cubic-bezier(.4,0,.2,1);
        cursor: pointer;
        outline: none;
        min-width: 0;
        min-height: 40px;
        text-align: center;
        letter-spacing: -0.01em;
        user-select: none;
    }
    .btn-glass-article {
        background: #ffffff;
        color: var(--primary-purple);
        border: 1.5px solid rgba(0,0,0,0.05);
        box-shadow: 0 1px 6px 0 rgba(0,0,0,0.05);
        font-weight: 600;
    }
    .btn-glass-article:hover, .btn-glass-article:focus {
        background: #fff;
        color: var(--primary-purple);
        border-color: var(--primary-purple);
        box-shadow: 0 2px 12px 0 rgba(107,71,255,0.15);
    }
    .btn-glass-use {
        background: var(--primary-purple);
        color: #fff;
        font-weight: 600;
        border: none;
        box-shadow: 0 1px 6px 0 rgba(107,71,255,0.15);
    }
    .btn-glass-use:hover, .btn-glass-use:focus {
        filter: brightness(1.05);
        color: #fff;
        box-shadow: 0 2px 12px 0 rgba(107,71,255,0.25);
    }
    .btn-glass i {
        font-size: 1em;
        margin-right: 0.3em;
        margin-left: 0;
    }
    @media (max-width: 600px) {
        .news-article-actions {
            flex-direction: column;
            gap: 0.5em;
            padding: 0 1rem 1rem 1rem;
        }
        .btn-glass {
            width: 100%;
        }
    }
    @media (max-width: 900px) {
        .news-section { padding: 1.2rem;}
        .news-articles-grid { grid-template-columns: 1fr;}
    }
</style>

<div class="news-section fade-in">
    <div class="news-header">
        <i class="fa-solid fa-newspaper icon-noble"></i>
        Assistant d'actualitÃ©
    </div>
    <div class="news-subtitle">
        Inspirez vos posts LinkedIn avec les sujets qui font lâ€™actualitÃ© de votre secteur.
    </div>
    <form method="get">
        <div class="news-form-row">
            <div class="news-form-group">
                <label for="keyword">Mot-clÃ©</label>
                <input type="text" id="keyword" name="keyword" class="news-form-control" placeholder="Ex: Intelligence artificielle" value="{{ keyword or '' }}">
            </div>
            <div class="news-form-group">
                <label for="language">Langue</label>
                <select id="language" name="language" class="news-form-control">
                    <option value="fr" {% if language == 'fr' %}selected{% endif %}>ðŸ‡«ðŸ‡· FranÃ§ais</option>
                    <option value="en" {% if language == 'en' %}selected{% endif %}>ðŸ‡ºðŸ‡¸ Anglais</option>
                </select>
            </div>
            <div>
                <button type="submit" class="btn-noble"><i class="fas fa-search"></i> Rechercher</button>
            </div>
        </div>
    </form>
    {% if secteur %}
        <div class="news-sector">ðŸ“‚ Secteur dÃ©tectÃ© : <span style="background:var(--noble-mist); border-radius:8px; padding:0.2em 0.7em;">{{ secteur }}</span></div>
    {% endif %}
    {% if error %}
        <div class="news-error">{{ error }}</div>
    {% endif %}

    {% if selected %}
    <div class="news-selected-article">
        <h3>ðŸ“° Article sÃ©lectionnÃ©</h3>
        <p style="font-size:1.1em; font-weight:600;">{{ selected.title }}</p>
        <p style="color:var(--noble-charcoal-light);">{{ selected.description }}</p>
        <a href="{{ selected.url }}" target="_blank" style="color:var(--primary-coral); text-decoration:underline;">Lire lâ€™article complet</a>
    </div>
    {% endif %}

    {% if news %}
    <h2 style="margin-bottom:1em; color:var(--primary-coral); font-size:1.3em; font-weight:700;">RÃ©sultats de recherche</h2>
    <div class="news-articles-grid">
        {% for article in news %}
        <div class="news-article-card">
            {% if article.urlToImage %}
                <img src="{{ article.urlToImage }}" alt="Image de l'article" class="news-article-image" loading="lazy">
            {% else %}
                <div class="news-article-image-placeholder">
                    <i class="fa-regular fa-image"></i>
                </div>
            {% endif %}
            <div class="news-article-content" style="display:flex; flex-direction:column; height:100%; justify-content:space-between;">
                <div>
                    <div class="news-article-title">{{ article.title|clean_html }}</div>
                    <div class="news-article-description">{{ article.description|clean_html }}</div>
                </div>
                <div class="news-article-meta">
                    <span><i class="fa-regular fa-calendar"></i> {{ article.formatted_date }}</span>
                    <span><i class="fa-solid fa-newspaper"></i> {{ article.source.name if article.source.name else article.source }}</span>
                </div>
            </div>
            <div class="news-article-actions">
                <a href="{{ article.url }}" target="_blank" class="btn-glass btn-glass-article">
                    <i class="fas fa-external-link"></i> Lire lâ€™article
                </a>
                <button onclick='selectArticle({{ loop.index0 }})' class="btn-glass btn-glass-use">
                    <i class="fas fa-feather-alt"></i> Utiliser cet article
                </button>
            </div>
            <script type="application/json" class="article-data-{{ loop.index0 }}">
            {
                "title": {{ article.title | tojson }},
                "description": {{ article.description | tojson }},
                "url": {{ article.url | tojson }},
                "source": {{ article.source | tojson }},
                "formatted_date": {{ article.formatted_date | tojson }},
                "urlToImage": {{ article.urlToImage | tojson }}
            }
            </script>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="news-article-card" style="background:var(--noble-mist); text-align:center; color:var(--noble-accent-light); margin-top:2em;">
        <i class="fa-regular fa-newspaper" style="font-size:2.5em;"></i>
        <p style="margin-top:1em; font-size:1.1em;">Aucune actualitÃ© trouvÃ©e pour lâ€™instant.</p>
    </div>
    {% endif %}
</div>
<script>
function selectArticle(index) {
    const json = document.querySelector('.article-data-' + index).textContent;
    fetch('/select_article', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: json
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            window.location.href = data.redirect;
        } else {
            alert('Erreur : ' + data.error);
        }
    })
    .catch(err => alert('Erreur rÃ©seau : ' + err));
}
</script>
{% endblock %}
