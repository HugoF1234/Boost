{% extends "base.html" %}
{% block content %}

<!-- Section d'accueil compacte séparée -->
<div class="welcome-section fade-in">
    <div class="welcome-content">
        <div>
            <h1 class="greeting">
                <i class="fas fa-history" style="color: var(--primary-coral);"></i>
            Mes posts
        </h1>
            <p class="greeting-subtitle">Gérez vos publications LinkedIn par statut</p>
        </div>
    </div>
</div>

<!-- Navigation conditionnelle -->
<div class="creation-section fade-in">
    {% set total_drafts = draft_posts|length if draft_posts else 0 %}
    {% set total_scheduled = scheduled_posts|length if scheduled_posts else 0 %}
    {% set total_published = published_posts|length if published_posts else 0 %}
    {% set show_navigation = total_drafts > 2 or total_scheduled > 2 or total_published > 2 %}
    
    {% if show_navigation %}
        <!-- Navigation avec onglets -->
        <div class="posts-navigation">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="all">
                    <i class="fas fa-th-large"></i>
                    Vue d'ensemble
                </button>
                <button class="nav-tab" data-tab="drafts">
                    <i class="fas fa-edit"></i>
                    Brouillons
                    <span class="tab-count">{{ total_drafts }}</span>
                </button>
                <button class="nav-tab" data-tab="scheduled">
                    <i class="fas fa-clock"></i>
                    Programmés
                    <span class="tab-count">{{ total_scheduled }}</span>
                </button>
                <button class="nav-tab" data-tab="published">
                    <i class="fas fa-check-circle"></i>
                    Publiés
                    <span class="tab-count">{{ total_published }}</span>
                </button>
            </div>
        </div>
    {% endif %}
    
    <!-- Contenu des posts avec style LinkedIn -->
    <div class="posts-content">
        <!-- Vue d'ensemble Kanban (toujours visible) -->
        <div id="tab-all" class="tab-content active">
    <div class="kanban-container">
        <!-- Brouillons -->
                <div class="kanban-column">
                    <div class="column-header linkedin-style">
                        <h3 class="column-title">
                            <i class="fas fa-edit" style="color: var(--primary-coral);"></i>
                            Brouillons
                        </h3>
                        <span class="column-count">{{ total_drafts }}</span>
                    </div>
                    <div class="column-content">
                        {% if draft_posts %}
                            {% for post in draft_posts[:3] %}
                            <div class="linkedin-post-card">
                                <div class="post-header">
                                    <div class="post-avatar">
                                        {% if picture %}
                                            <img src="{{ picture }}" alt="Votre photo">
                                        {% else %}
                                            <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="post-meta">
                                        <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                        <div class="post-date">
                                            <i class="fas fa-calendar" style="color: var(--gray-medium);"></i>
                                            Créé le {{ post.created_at.strftime('%d/%m/%Y à %H:%M') if post.created_at else 'Date inconnue' }}
                                        </div>
                                        <div class="post-status status-draft">
                                            <i class="fas fa-edit"></i> Brouillon
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content-text">{{ post.content|truncate(150) }}</div>
                                <div class="post-actions linkedin-actions">
                                    <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn-linkedin btn-edit">
                                        <i class="fas fa-edit"></i> Modifier
                                    </a>
                                    <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce brouillon ?')">
                                        <i class="fas fa-trash"></i> Supprimer
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                            {% if total_drafts > 3 %}
                            <div class="see-more-card">
                                <button class="btn-see-more" onclick="showTab('drafts')">
                                    Voir {{ total_drafts - 3 }} brouillons de plus
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            {% endif %}
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-edit"></i></div>
                                <p class="empty-text">Aucun brouillon</p>
                                <small>Créez du contenu depuis le dashboard</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Programmés -->
                <div class="kanban-column">
                    <div class="column-header linkedin-style">
                        <h3 class="column-title">
                            <i class="fas fa-clock" style="color: var(--primary-coral);"></i>
                            Programmés
                        </h3>
                        <span class="column-count">{{ total_scheduled }}</span>
                    </div>
                    <div class="column-content">
                        {% if scheduled_posts %}
                            {% for post in scheduled_posts[:3] %}
                            <div class="linkedin-post-card">
                                <div class="post-header">
                                    <div class="post-avatar">
                                        {% if picture %}
                                            <img src="{{ picture }}" alt="Votre photo">
                                        {% else %}
                                            <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="post-meta">
                                        <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                        <div class="post-date">
                                            <i class="fas fa-clock" style="color: var(--gray-medium);"></i>
                                            Programmé pour le {{ post.scheduled_at.strftime('%d/%m/%Y à %H:%M') if post.scheduled_at else 'Date inconnue' }}
                                        </div>
                                        <div class="post-status status-scheduled">
                                            <i class="fas fa-clock"></i> Programmé
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content-text">{{ post.content|truncate(150) }}</div>
                                <div class="post-actions linkedin-actions">
                                    <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn-linkedin btn-edit">
                                        <i class="fas fa-edit"></i> Modifier
                                    </a>
                                    <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce post programmé ?')">
                                        <i class="fas fa-trash"></i> Supprimer
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                            {% if total_scheduled > 3 %}
                            <div class="see-more-card">
                                <button class="btn-see-more" onclick="showTab('scheduled')">
                                    Voir {{ total_scheduled - 3 }} posts programmés de plus
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            {% endif %}
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-clock"></i></div>
                                <p class="empty-text">Aucun post programmé</p>
                                <small>Programmez vos publications à l'avance</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Publiés -->
                <div class="kanban-column">
                    <div class="column-header linkedin-style">
                        <h3 class="column-title">
                            <i class="fas fa-check-circle" style="color: var(--primary-coral);"></i>
                            Publiés
                        </h3>
                        <span class="column-count">{{ total_published }}</span>
                    </div>
                    <div class="column-content">
                        {% if published_posts %}
                            {% for post in published_posts[:3] %}
                            <div class="linkedin-post-card">
                                <div class="post-header">
                                    <div class="post-avatar">
                                        {% if picture %}
                                            <img src="{{ picture }}" alt="Votre photo">
                                        {% else %}
                                            <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="post-meta">
                                        <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                        <div class="post-date">
                                            <i class="fas fa-check-circle" style="color: var(--gray-medium);"></i>
                                            Publié le {{ post.published_at.strftime('%d/%m/%Y à %H:%M') if post.published_at else 'Date inconnue' }}
                                        </div>
                                        <div class="post-status status-published">
                                            <i class="fas fa-check-circle"></i> Publié
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content-text">{{ post.content|truncate(150) }}</div>
                                <div class="post-actions linkedin-actions">
                                    {% if post.linkedin_post_urn %}
                                    <a href="#" class="btn-linkedin btn-view" onclick="window.open('https://linkedin.com', '_blank')">
                                        <i class="fab fa-linkedin"></i> Voir sur LinkedIn
                                    </a>
                                    {% endif %}
                                    <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce post publié ?')">
                                        <i class="fas fa-trash"></i> Supprimer
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                            {% if total_published > 3 %}
                            <div class="see-more-card">
                                <button class="btn-see-more" onclick="showTab('published')">
                                    Voir {{ total_published - 3 }} posts publiés de plus
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            {% endif %}
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-check-circle"></i></div>
                                <p class="empty-text">Aucune publication</p>
                                <small>Vos posts publiés apparaîtront ici</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pages dédiées (toujours présentes si navigation active) -->
        {% if show_navigation %}
        <div id="tab-drafts" class="tab-content">
            <div class="dedicated-page">
                <h2 class="page-title">
                    <i class="fas fa-edit" style="color: var(--primary-coral);"></i>
                    Tous les brouillons ({{ total_drafts }})
                </h2>
                {% if draft_posts %}
                <div class="posts-grid">
                    {% for post in draft_posts %}
                    <div class="linkedin-post-card">
                        <div class="post-header">
                            <div class="post-avatar">
                                {% if picture %}
                                    <img src="{{ picture }}" alt="Votre photo">
                                {% else %}
                                    <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                {% endif %}
                            </div>
                            <div class="post-meta">
                                <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                <div class="post-date">
                                    <i class="fas fa-calendar" style="color: var(--gray-medium);"></i>
                                    Créé le {{ post.created_at.strftime('%d/%m/%Y à %H:%M') if post.created_at else 'Date inconnue' }}
                                </div>
                                <div class="post-status status-draft">
                                    <i class="fas fa-edit"></i> Brouillon
                                </div>
                            </div>
                        </div>
                        <div class="post-content-text">{{ post.content }}</div>
                        <div class="post-actions linkedin-actions">
                            <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn-linkedin btn-edit">
                                <i class="fas fa-edit"></i> Modifier
                            </a>
                            <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                               onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce brouillon ?')">
                                <i class="fas fa-trash"></i> Supprimer
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-edit"></i></div>
                    <p class="empty-text">Aucun brouillon</p>
                    <small>Créez du contenu depuis le dashboard</small>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div id="tab-scheduled" class="tab-content">
            <div class="dedicated-page">
                <h2 class="page-title">
                    <i class="fas fa-clock" style="color: var(--primary-coral);"></i>
                    Tous les posts programmés ({{ total_scheduled }})
                </h2>
                {% if scheduled_posts %}
                <div class="posts-grid">
                    {% for post in scheduled_posts %}
                    <div class="linkedin-post-card">
                        <div class="post-header">
                            <div class="post-avatar">
                                {% if picture %}
                                    <img src="{{ picture }}" alt="Votre photo">
                                {% else %}
                                    <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                {% endif %}
                            </div>
                            <div class="post-meta">
                                <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                <div class="post-date">
                                    <i class="fas fa-clock" style="color: var(--gray-medium);"></i>
                                    Programmé pour le {{ post.scheduled_at.strftime('%d/%m/%Y à %H:%M') if post.scheduled_at else 'Date inconnue' }}
                                </div>
                                <div class="post-status status-scheduled">
                                    <i class="fas fa-clock"></i> Programmé
                                </div>
                            </div>
                        </div>
                        <div class="post-content-text">{{ post.content }}</div>
                        <div class="post-actions linkedin-actions">
                            <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn-linkedin btn-edit">
                                <i class="fas fa-edit"></i> Modifier
                            </a>
                            <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                               onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce post programmé ?')">
                                <i class="fas fa-trash"></i> Supprimer
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-clock"></i></div>
                    <p class="empty-text">Aucun post programmé</p>
                    <small>Programmez vos publications à l'avance</small>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div id="tab-published" class="tab-content">
            <div class="dedicated-page">
                <h2 class="page-title">
                    <i class="fas fa-check-circle" style="color: var(--primary-coral);"></i>
                    Tous les posts publiés ({{ total_published }})
                </h2>
                {% if published_posts %}
                <div class="posts-grid">
                    {% for post in published_posts %}
                    <div class="linkedin-post-card">
                        <div class="post-header">
                            <div class="post-avatar">
                                {% if picture %}
                                    <img src="{{ picture }}" alt="Votre photo">
                                {% else %}
                                    <div class="avatar-placeholder">{{ first_name[0]|upper if first_name else 'U' }}</div>
                                {% endif %}
                            </div>
                            <div class="post-meta">
                                <div class="post-author">{{ first_name }} {{ last_name }}</div>
                                <div class="post-date">
                                    <i class="fas fa-check-circle" style="color: var(--gray-medium);"></i>
                                    Publié le {{ post.published_at.strftime('%d/%m/%Y à %H:%M') if post.published_at else 'Date inconnue' }}
                                </div>
                                <div class="post-status status-published">
                                    <i class="fas fa-check-circle"></i> Publié
                                </div>
                            </div>
                        </div>
                        <div class="post-content-text">{{ post.content }}</div>
                        <div class="post-actions linkedin-actions">
                            {% if post.linkedin_post_urn %}
                            <a href="#" class="btn-linkedin btn-view" onclick="window.open('https://linkedin.com', '_blank')">
                                <i class="fab fa-linkedin"></i> Voir sur LinkedIn
                            </a>
                            {% endif %}
                            <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn-linkedin btn-delete" 
                               onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce post publié ?')">
                                <i class="fas fa-trash"></i> Supprimer
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-check-circle"></i></div>
                    <p class="empty-text">Aucune publication</p>
                    <small>Vos posts publiés apparaîtront ici</small>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation fade-in
    const elements = document.querySelectorAll('.fade-in');
    elements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
        setTimeout(() => {
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 200);
    });
    
    // Gestion des onglets
    const navTabs = document.querySelectorAll('.nav-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    navTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            showTab(tabId);
        });
    });
    
    window.showTab = function(tabId) {
        // Mettre à jour les onglets
        navTabs.forEach(tab => {
            tab.classList.remove('active');
            if (tab.getAttribute('data-tab') === tabId) {
                tab.classList.add('active');
            }
        });
        
        // Mettre à jour le contenu
        tabContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === 'tab-' + tabId) {
                content.classList.add('active');
            }
        });
    };
    
    // Animations hover pour les cartes LinkedIn
    document.querySelectorAll('.linkedin-post-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.12)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.06)';
        });
    });
});
</script>
{% endblock %}
