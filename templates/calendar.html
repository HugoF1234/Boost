{% extends "base.html" %}
{% block content %}
<style>
    /* Variables nobles et apaisantes */
    :root {
        --noble-cream: #faf9f7;
        --noble-warm: #f5f2ed;
        --noble-sage: #8b9a7c;
        --noble-sage-light: #a8b59a;
        --noble-sage-dark: #6b7865;
        --noble-stone: #e8e4de;
        --noble-charcoal: #4a4943;
        --noble-charcoal-light: #6b6960;
        --noble-mist: #f0ede8;
        --noble-accent: #9c8b7a;
        --noble-accent-light: #b5a495;
        
        /* Couleurs fonctionnelles douces */
        --gentle-success: #7c9885;
        --gentle-warning: #b8a082;
        --gentle-info: #8ba3b8;
        
        /* Ombres très subtiles */
        --shadow-whisper: 0 2px 12px rgba(139, 154, 124, 0.08);
        --shadow-gentle: 0 4px 20px rgba(139, 154, 124, 0.12);
        --shadow-soft: 0 8px 32px rgba(139, 154, 124, 0.16);
    }

    body {
        background: var(--noble-cream);
        color: var(--noble-charcoal);
        line-height: 1.7;
    }

    /* Header noble et accueillant */
    .calendar-header {
        background: linear-gradient(135deg, var(--noble-warm) 0%, var(--noble-mist) 100%);
        color: var(--noble-charcoal);
        padding: 2.5rem;
        border-radius: 20px;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-whisper);
        border: 1px solid var(--noble-stone);
    }

    .calendar-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 120px;
        height: 120px;
        background: radial-gradient(circle, rgba(139, 154, 124, 0.06) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(30%, -30%);
    }

    .header-content {
        position: relative;
        z-index: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1.5rem;
    }

    .calendar-title {
        font-size: 2rem;
        font-weight: 600;
        margin: 0;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 1rem;
        color: var(--noble-charcoal);
    }

    .calendar-subtitle {
        font-size: 1rem;
        font-weight: 400;
        margin-top: 0.5rem;
        color: var(--noble-charcoal-light);
    }

    .calendar-nav {
        display: flex;
        align-items: center;
        gap: 1rem;
        position: relative;
        z-index: 1;
    }

    .nav-button {
        padding: 0.75rem 1rem;
        border-radius: 12px;
        border: 1.5px solid var(--noble-stone);
        background: white;
        color: var(--noble-charcoal);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .nav-button:hover {
        background: var(--noble-sage);
        color: white;
        border-color: var(--noble-sage);
        transform: translateY(-1px);
        box-shadow: var(--shadow-gentle);
    }

    .week-period {
        font-size: 0.9rem;
        color: var(--noble-charcoal-light);
        font-weight: 500;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 10px;
        border: 1px solid var(--noble-stone);
    }

    /* Boutons nobles */
    .btn-noble {
        padding: 0.875rem 1.75rem;
        border-radius: 12px;
        font-weight: 500;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.625rem;
        text-decoration: none;
        border: none;
        position: relative;
        overflow: hidden;
    }

    .btn-primary-noble {
        background: linear-gradient(135deg, var(--noble-sage) 0%, var(--noble-sage-light) 100%);
        color: white;
        box-shadow: var(--shadow-whisper);
    }

    .btn-primary-noble:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-gentle);
        background: linear-gradient(135deg, var(--noble-sage-dark) 0%, var(--noble-sage) 100%);
    }

    /* Grille de calendrier innovante */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: var(--noble-stone);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-whisper);
        margin-bottom: 2rem;
    }

    .calendar-day {
        background: white;
        min-height: 180px;
        position: relative;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .calendar-day:hover {
        background: var(--noble-mist);
        transform: scale(1.02);
        box-shadow: var(--shadow-gentle);
        z-index: 10;
    }

    .day-header {
        padding: 1rem;
        border-bottom: 1px solid var(--noble-stone);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--noble-warm);
        position: relative;
    }

    .day-number {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--noble-charcoal);
    }

    .day-name {
        font-size: 0.8rem;
        color: var(--noble-charcoal-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
    }

    .day-today {
        background: linear-gradient(135deg, var(--noble-sage) 0%, var(--noble-sage-light) 100%);
        color: white;
    }

    .day-today .day-number,
    .day-today .day-name {
        color: white;
    }

    .day-other-month {
        opacity: 0.4;
        background: var(--noble-mist);
    }

    .day-content {
        flex: 1;
        padding: 0.5rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    /* Posts planifiés */
    .scheduled-post {
        background: linear-gradient(135deg, rgba(139, 154, 124, 0.1) 0%, rgba(156, 139, 122, 0.1) 100%);
        border: 1px solid var(--noble-sage-light);
        border-radius: 8px;
        padding: 0.5rem;
        font-size: 0.75rem;
        line-height: 1.3;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .scheduled-post::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--noble-sage);
        border-radius: 1px;
    }

    .scheduled-post:hover {
        background: linear-gradient(135deg, var(--noble-sage-light) 0%, var(--noble-accent-light) 100%);
        transform: translateY(-1px);
        box-shadow: var(--shadow-gentle);
        border-color: var(--noble-sage);
    }

    .post-time {
        font-weight: 600;
        color: var(--noble-sage);
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .post-preview {
        color: var(--noble-charcoal);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .post-indicator {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 8px;
        height: 8px;
        background: var(--noble-sage);
        border-radius: 50%;
        opacity: 0.7;
    }

    /* En-têtes des jours de la semaine */
    .calendar-header-row {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: var(--noble-stone);
        border-radius: 16px 16px 0 0;
        overflow: hidden;
        margin-bottom: 1px;
    }

    .day-header-cell {
        background: var(--noble-sage);
        color: white;
        padding: 1rem;
        text-align: center;
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Légende du calendrier */
    .calendar-legend {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--noble-stone);
        box-shadow: var(--shadow-whisper);
    }

    .legend-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--noble-charcoal);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .legend-items {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.9rem;
        color: var(--noble-charcoal-light);
    }

    .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .legend-planned {
        background: var(--noble-sage);
    }

    .legend-today {
        background: var(--noble-accent);
    }

    /* Statistiques du calendrier */
    .calendar-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 2rem;
        border-radius: 16px;
        text-align: center;
        border: 1px solid var(--noble-stone);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        box-shadow: var(--shadow-whisper);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, var(--noble-sage), var(--noble-accent));
        transition: all 0.6s ease;
    }

    .stat-card:hover::before {
        left: 0;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-gentle);
        border-color: var(--noble-sage-light);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        margin: 0 auto 1rem;
        background: linear-gradient(135deg, var(--noble-sage) 0%, var(--noble-accent) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: white;
        transition: all 0.3s ease;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(10deg);
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--noble-sage);
        margin-bottom: 0.5rem;
        display: block;
    }

    .stat-label {
        color: var(--noble-charcoal-light);
        font-weight: 500;
        font-size: 0.9rem;
    }

    /* Actions rapides */
    .quick-actions {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        border: 1px solid var(--noble-stone);
        box-shadow: var(--shadow-whisper);
        margin-bottom: 2rem;
    }

    .actions-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--noble-charcoal);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .action-button {
        padding: 1rem 1.5rem;
        background: var(--noble-warm);
        border: 1px solid var(--noble-stone);
        border-radius: 12px;
        color: var(--noble-charcoal);
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .action-button:hover {
        background: var(--noble-sage);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-gentle);
    }

    .action-icon {
        width: 30px;
        height: 30px;
        background: var(--noble-sage);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .action-button:hover .action-icon {
        background: white;
        color: var(--noble-sage);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            text-align: center;
        }

        .calendar-grid {
            font-size: 0.8rem;
        }

        .calendar-day {
            min-height: 120px;
        }

        .day-header {
            padding: 0.5rem;
        }

        .day-content {
            padding: 0.25rem;
        }

        .scheduled-post {
            font-size: 0.7rem;
            padding: 0.375rem;
        }

        .calendar-stats {
            grid-template-columns: repeat(2, 1fr);
        }

        .actions-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Animations nobles */
    .fade-in {
        animation: gentleFadeIn 0.8s ease-out;
    }

    @keyframes gentleFadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .slide-in {
        animation: gentleSlideIn 0.6s ease-out;
    }

    @keyframes gentleSlideIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
</style>

<!-- Header noble -->
<div class="calendar-header fade-in">
    <div class="header-content">
        <div>
            <h1 class="calendar-title">
                <i class="fas fa-calendar-week" style="color: var(--noble-sage);"></i>
                Calendrier éditorial
            </h1>
            <p class="calendar-subtitle">Visualisez et gérez vos publications LinkedIn sur les 2 prochaines semaines</p>
        </div>
        <div class="calendar-nav">
            <button class="nav-button" onclick="navigateWeeks(-1)">
                <i class="fas fa-chevron-left"></i>
                Semaine précédente
            </button>
            <div class="week-period" id="week-period">
                <!-- Période dynamique -->
            </div>
            <button class="nav-button" onclick="navigateWeeks(1)">
                Semaine suivante
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Statistiques nobles -->
<div class="calendar-stats fade-in">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-calendar-check"></i>
        </div>
        <span class="stat-number" id="total-scheduled">
            {% if posts %}{{ posts|length }}{% else %}0{% endif %}
        </span>
        <div class="stat-label">Posts programmés</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-clock"></i>
        </div>
        <span class="stat-number" id="this-week">0</span>
        <div class="stat-label">Cette semaine</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-calendar-day"></i>
        </div>
        <span class="stat-number" id="today-posts">0</span>
        <div class="stat-label">Aujourd'hui</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <span class="stat-number">2-3</span>
        <div class="stat-label">Fréquence/semaine</div>
    </div>
</div>

<!-- Légende noble -->
<div class="calendar-legend slide-in">
    <h3 class="legend-title">
        <i class="fas fa-info-circle" style="color: var(--noble-sage);"></i>
        Légende
    </h3>
    <div class="legend-items">
        <div class="legend-item">
            <div class="legend-dot legend-planned"></div>
            <span>Publication programmée</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot legend-today"></div>
            <span>Aujourd'hui</span>
        </div>
        <div class="legend-item">
            <i class="fas fa-circle" style="color: var(--noble-sage); font-size: 8px;"></i>
            <span>Contenu planifié</span>
        </div>
    </div>
</div>

<!-- Grille de calendrier innovante -->
<div class="calendar-header-row">
    <div class="day-header-cell">Lun</div>
    <div class="day-header-cell">Mar</div>
    <div class="day-header-cell">Mer</div>
    <div class="day-header-cell">Jeu</div>
    <div class="day-header-cell">Ven</div>
    <div class="day-header-cell">Sam</div>
    <div class="day-header-cell">Dim</div>
</div>

<div class="calendar-grid slide-in" id="calendar-grid">
    <!-- Généré dynamiquement par JavaScript -->
</div>

<!-- Actions rapides nobles -->
<div class="quick-actions fade-in">
    <h3 class="actions-title">
        <i class="fas fa-lightning-bolt" style="color: var(--noble-sage);"></i>
        Actions rapides
    </h3>
    <div class="actions-grid">
        <a href="{{ url_for('dashboard') }}" class="action-button">
            <div class="action-icon">
                <i class="fas fa-plus"></i>
            </div>
            <span>Nouveau post</span>
        </a>
        
        <a href="{{ url_for('news_assistant') }}" class="action-button">
            <div class="action-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <span>Actualités tendance</span>
        </a>
        
        <a href="{{ url_for('historique') }}" class="action-button">
            <div class="action-icon">
                <i class="fas fa-history"></i>
            </div>
            <span>Historique</span>
        </a>
        
        <button class="action-button" onclick="generateWeeklyPlan()">
            <div class="action-icon">
                <i class="fas fa-magic"></i>
            </div>
            <span>Plan hebdomadaire IA</span>
        </button>
    </div>
</div>

<script>
// Configuration noble avec sécurité
const config = {
    currentWeekOffset: 0,
    scheduledPosts: [
        {% if posts %}
            {% for post in posts %}
                {% if post.scheduled and post.published_at %}
                {
                    id: {{ post.id }},
                    content: {{ (post.content or '')|tojson }},
                    publishedAt: new Date('{{ post.published_at.isoformat() }}'),
                    scheduled: true
                }{% if not loop.last %},{% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
    ]
};

// Utilitaires nobles
function getWeekStart(date, offset = 0) {
    const d = new Date(date);
    d.setDate(d.getDate() + (offset * 7));
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
}

function formatDate(date) {
    return date.toLocaleDateString('fr-FR', { 
        day: '2-digit', 
        month: 'long',
        year: 'numeric'
    });
}

function isSameDay(date1, date2) {
    return date1.toDateString() === date2.toDateString();
}

function isToday(date) {
    return isSameDay(date, new Date());
}

// Génération noble du calendrier
function generateCalendar() {
    const calendarGrid = document.getElementById('calendar-grid');
    const today = new Date();
    const weekStart = getWeekStart(today, config.currentWeekOffset);
    
    // Mise à jour de la période affichée
    const weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate() + 13); // 2 semaines
    
    const weekPeriodElement = document.getElementById('week-period');
    if (weekPeriodElement) {
        weekPeriodElement.textContent = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
    }
    
    // Génération des 14 jours
    if (calendarGrid) {
        calendarGrid.innerHTML = '';
        
        for (let i = 0; i < 14; i++) {
            const currentDate = new Date(weekStart);
            currentDate.setDate(weekStart.getDate() + i);
            
            const dayElement = createDayElement(currentDate);
            calendarGrid.appendChild(dayElement);
        }
    }
    
    updateStats();
}

// Création noble d'un élément jour
function createDayElement(date) {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'calendar-day';
    
    if (isToday(date)) {
        dayDiv.classList.add('day-today');
    }
    
    // En-tête du jour
    const headerDiv = document.createElement('div');
    headerDiv.className = 'day-header';
    
    const dayInfo = document.createElement('div');
    dayInfo.innerHTML = `
        <div class="day-number">${date.getDate()}</div>
        <div class="day-name">${date.toLocaleDateString('fr-FR', { weekday: 'short' })}</div>
    `;
    
    headerDiv.appendChild(dayInfo);
    
    // Contenu du jour
    const contentDiv = document.createElement('div');
    contentDiv.className = 'day-content';
    
    // Filtrer les posts pour ce jour
    const dayPosts = config.scheduledPosts.filter(post => 
        post.scheduled && isSameDay(post.publishedAt, date)
    );
    
    // Trier par heure
    dayPosts.sort((a, b) => a.publishedAt.getTime() - b.publishedAt.getTime());
    
    // Ajouter les posts
    dayPosts.forEach(post => {
        const postElement = createPostElement(post);
        contentDiv.appendChild(postElement);
    });
    
    // Indicateur s'il y a des posts
    if (dayPosts.length > 0) {
        const indicator = document.createElement('div');
        indicator.className = 'post-indicator';
        headerDiv.appendChild(indicator);
    }
    
    dayDiv.appendChild(headerDiv);
    dayDiv.appendChild(contentDiv);
    
    // Interaction noble pour ajouter un post
    dayDiv.addEventListener('click', (e) => {
        if (!e.target.closest('.scheduled-post')) {
            openNewPostDialog(date);
        }
    });
    
    return dayDiv;
}

// Création noble d'un élément post
function createPostElement(post) {
    const postDiv = document.createElement('div');
    postDiv.className = 'scheduled-post';
    
    const timeFormatted = post.publishedAt.toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    const preview = post.content && post.content.length > 60 
        ? post.content.substring(0, 60) + '...'
        : post.content || 'Post sans contenu';
    
    postDiv.innerHTML = `
        <div class="post-time">
            <i class="fas fa-clock" style="font-size: 0.7rem;"></i>
            ${timeFormatted}
        </div>
        <div class="post-preview">${preview}</div>
    `;
    
    // Interaction noble
    postDiv.addEventListener('click', (e) => {
        e.stopPropagation();
        openPostDetails(post);
    });
    
    return postDiv;
}

// Navigation noble entre les semaines
function navigateWeeks(direction) {
    config.currentWeekOffset += direction;
    
    // Animation douce
    const calendarGrid = document.getElementById('calendar-grid');
    if (calendarGrid) {
        calendarGrid.style.opacity = '0';
        calendarGrid.style.transform = `translateX(${direction * 20}px)`;
        
        setTimeout(() => {
            generateCalendar();
            calendarGrid.style.opacity = '1';
            calendarGrid.style.transform = 'translateX(0)';
        }, 200);
    }
}

// Mise à jour noble des statistiques
function updateStats() {
    const today = new Date();
    const weekStart = getWeekStart(today, config.currentWeekOffset);
    const weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate() + 6);
    
    // Posts cette semaine
    const thisWeekPosts = config.scheduledPosts.filter(post => 
        post.scheduled && 
        post.publishedAt >= weekStart && 
        post.publishedAt <= weekEnd
    );
    
    // Posts aujourd'hui
    const todayPosts = config.scheduledPosts.filter(post => 
        post.scheduled && isSameDay(post.publishedAt, today)
    );
    
    // Mise à jour avec animation
    animateNumber('this-week', thisWeekPosts.length);
    animateNumber('today-posts', todayPosts.length);
}

// Animation noble des nombres
function animateNumber(elementId, targetValue) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    const currentValue = parseInt(element.textContent) || 0;
    
    if (currentValue === targetValue) return;
    
    const increment = targetValue > currentValue ? 1 : -1;
    let current = currentValue;
    
    const timer = setInterval(() => {
        current += increment;
        element.textContent = current;
        
        if (current === targetValue) {
            clearInterval(timer);
            // Effet de mise en évidence
            element.style.transform = 'scale(1.1)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }
    }, 50);
}

// Dialogue noble pour nouveau post
function openNewPostDialog(date) {
    const formattedDate = date.toLocaleDateString('fr-FR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    // Créer un overlay noble
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(139, 154, 124, 0.3);
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.3s ease;
    `;
    
    const dialog = document.createElement('div');
    dialog.style.cssText = `
        background: white;
        border-radius: 20px;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--noble-stone);
        transform: scale(0.9);
        transition: all 0.3s ease;
    `;
    
    dialog.innerHTML = `
        <h3 style="color: var(--noble-charcoal); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
            <i class="fas fa-plus-circle" style="color: var(--noble-sage);"></i>
            Nouveau post
        </h3>
        <p style="color: var(--noble-charcoal-light); margin-bottom: 1.5rem; font-size: 0.95rem;">
            Programmer un post pour le <strong>${formattedDate}</strong>
        </p>
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button onclick="closeDialog()" class="btn-noble" style="background: var(--noble-warm); color: var(--noble-charcoal); border: 1px solid var(--noble-stone);">
                Annuler
            </button>
            <a href="{{ url_for('dashboard') }}" class="btn-noble btn-primary-noble">
                <i class="fas fa-pen-to-square"></i>
                Créer un post
            </a>
        </div>
    `;
    
    overlay.appendChild(dialog);
    document.body.appendChild(overlay);
    
    // Animation d'entrée
    requestAnimationFrame(() => {
        overlay.style.opacity = '1';
        dialog.style.transform = 'scale(1)';
    });
    
    // Fermeture au clic sur l'overlay
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            closeDialog();
        }
    });
    
    // Fonction globale de fermeture
    window.closeDialog = () => {
        overlay.style.opacity = '0';
        dialog.style.transform = 'scale(0.9)';
        setTimeout(() => {
            if (overlay.parentNode) {
                document.body.removeChild(overlay);
            }
            delete window.closeDialog;
        }, 300);
    };
}

// Détails noble d'un post
function openPostDetails(post) {
    const formattedDate = post.publishedAt.toLocaleDateString('fr-FR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    const formattedTime = post.publishedAt.toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // Créer un overlay noble
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(139, 154, 124, 0.3);
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.3s ease;
    `;
    
    const dialog = document.createElement('div');
    dialog.style.cssText = `
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--noble-stone);
        transform: scale(0.9);
        transition: all 0.3s ease;
    `;
    
    dialog.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
            <h3 style="color: var(--noble-charcoal); margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-calendar-check" style="color: var(--noble-sage);"></i>
                Post programmé
            </h3>
            <button onclick="closePostDialog()" style="background: none; border: none; color: var(--noble-charcoal-light); font-size: 1.2rem; cursor: pointer; padding: 0.25rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div style="background: var(--noble-warm); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border-left: 4px solid var(--noble-sage);">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <div style="background: var(--noble-sage); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem;">
                    <i class="fas fa-clock"></i>
                    ${formattedTime}
                </div>
                <div style="color: var(--noble-charcoal-light); font-size: 0.9rem;">
                    ${formattedDate}
                </div>
            </div>
            <div style="color: var(--noble-charcoal); line-height: 1.6; font-size: 0.95rem;">
                ${post.content || 'Contenu non disponible'}
            </div>
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: flex-end; flex-wrap: wrap;">
            <a href="/edit_post/${post.id}" class="btn-noble" style="background: var(--noble-sage-light); color: white; border: none;">
                <i class="fas fa-edit"></i>
                Modifier
            </a>
            <a href="/delete_post/${post.id}" class="btn-noble" style="background: #f87171; color: white; border: none;">
                <i class="fas fa-trash"></i>
                Supprimer
            </a>
            <button onclick="closePostDialog()" class="btn-noble" style="background: var(--noble-warm); color: var(--noble-charcoal); border: 1px solid var(--noble-stone);">
                Fermer
            </button>
        </div>
    `;
    
    overlay.appendChild(dialog);
    document.body.appendChild(overlay);
    
    // Animation d'entrée
    requestAnimationFrame(() => {
        overlay.style.opacity = '1';
        dialog.style.transform = 'scale(1)';
    });
    
    // Fermeture au clic sur l'overlay
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            closePostDialog();
        }
    });
    
    // Fonction globale de fermeture
    window.closePostDialog = () => {
        overlay.style.opacity = '0';
        dialog.style.transform = 'scale(0.9)';
        setTimeout(() => {
            if (overlay.parentNode) {
                document.body.removeChild(overlay);
            }
            delete window.closePostDialog;
        }, 300);
    };
}

// Plan hebdomadaire IA noble
function generateWeeklyPlan() {
    // Créer une notification noble
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, var(--noble-sage) 0%, var(--noble-sage-light) 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: var(--shadow-gentle);
        z-index: 1001;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
    `;
    
    notification.innerHTML = `
        <i class="fas fa-magic"></i>
        <span>Fonctionnalité en développement...</span>
    `;
    
    document.body.appendChild(notification);
    
    // Animation d'entrée
    requestAnimationFrame(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    });
    
    // Auto-suppression
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Initialisation noble
document.addEventListener('DOMContentLoaded', function() {
    // Génération initiale du calendrier
    generateCalendar();
    
    // Animations progressives des éléments
    const elements = document.querySelectorAll('.fade-in, .slide-in');
    elements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.8s ease';
        
        setTimeout(() => {
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 200);
    });
    
    // Animation des cartes statistiques
    document.querySelectorAll('.stat-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px) scale(0.95)';
        card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0) scale(1)';
        }, index * 150);
    });
    
    // Interactions nobles sur les boutons
    document.querySelectorAll('.btn-noble, .nav-button, .action-button').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-1px)';
        });
        
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
        
        btn.addEventListener('mousedown', function() {
            this.style.transform = 'translateY(0) scale(0.98)';
        });
        
        btn.addEventListener('mouseup', function() {
            this.style.transform = 'translateY(-1px) scale(1)';
        });
    });
    
    // Animation des cartes de statistiques au hover
    document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            const icon = this.querySelector('.stat-icon');
            if (icon) {
                icon.style.transform = 'scale(1.15) rotate(15deg)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            const icon = this.querySelector('.stat-icon');
            if (icon) {
                icon.style.transform = 'scale(1) rotate(0deg)';
            }
        });
    });
    
    // Gestion noble du responsive
    function handleResponsive() {
        const isMobile = window.innerWidth <= 768;
        const calendarGrid = document.getElementById('calendar-grid');
        
        if (calendarGrid && isMobile) {
            calendarGrid.style.fontSize = '0.8rem';
        }
    }
    
    window.addEventListener('resize', handleResponsive);
    handleResponsive();
    
    // Rafraîchissement automatique des données
    setInterval(() => {
        updateStats();
    }, 60000); // Toutes les minutes
    
    // Gestion noble des raccourcis clavier
    document.addEventListener('keydown', function(e) {
        // Flèche gauche : semaine précédente
        if (e.key === 'ArrowLeft' && !e.target.matches('input, textarea')) {
            e.preventDefault();
            navigateWeeks(-1);
        }
        
        // Flèche droite : semaine suivante
        if (e.key === 'ArrowRight' && !e.target.matches('input, textarea')) {
            e.preventDefault();
            navigateWeeks(1);
        }
        
        // Echap : fermer les dialogues
        if (e.key === 'Escape') {
            if (window.closeDialog) window.closeDialog();
            if (window.closePostDialog) window.closePostDialog();
        }
        
        // N : nouveau post
        if (e.key.toLowerCase() === 'n' && !e.target.matches('input, textarea')) {
            window.location.href = '/dashboard';
        }
    });
});
</script>

{% endblock %}
